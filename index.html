<!DOCTYPE html>
<html>
<head>
    <title>Portland Cyclist and Pedestrian Crashes</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

    <!-- Make sure you put this AFTER Leaflet's CSS -->

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <!-- 2. Include Leaflet.markercluster CSS and JS -->
    <link rel="stylesheet" href="Leaflet.markercluster-1.1.0/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="Leaflet.markercluster-1.1.0/dist/MarkerCluster.Default.css" />
    <script src="Leaflet.markercluster-1.1.0/dist/leaflet.markercluster.js" />

    <style>
        #mapid { height: 95vh; }
    </style>
</head>
<body>

<div id="mapid"></div>

<script src="crash_map.js"></script>

<!--
<script type="text/javascript">
var getlabel = function (feature) {
    var retstr = "DOT ID: " + feature.properties["MDOT ID"] +
        ", date: " +
        feature.properties["Crash Date"]
    if ( feature.properties["Bicycle Yes/No"] == "Y" ) {
        retstr += "\nCyclist "}
    if ( feature.properties["Pedestrian Yes/No"] == "Y" ) {
        retstr += "\nPedestrian " }
    if (Number(feature.properties["K - Fatalities Count"]) > 0) {
        retstr += "killed" }
    if (Number(feature.properties["A - Suspected Serious Injury Count"]) > 0) {
        retstr += "seriously injured"
    }
    return retstr
}

var circleMarkerStyle = {
    radius: 8,
    fillColor: '#ffffff',
    color: '#000',
    weight: 1,
    opacity: 1,
    fillOpacity: 0.8
}

var getMarker = function (feature, latlng) {
    var localStyle = circleMarkerStyle;
    if (Number(feature.properties["K - Fatalities Count"]) > 0) {
        localStyle.fillColor = "#ff7800"
    } else if (Number(feature.properties["A - Suspected Serious Injury Count"]) > 0) {
        localStyle.fillColor = "#0078ff"
    } else {
        localStyle.fillColor = "#00ff00"
    }
    return L.circleMarker(latlng, localStyle);
}

// 1. Initialize the map
const map = L.map('mapid').setView([43.65734974239763, -70.26189624400604], 15);

// Add a tile layer (OpenStreetMap)
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© [OpenStreetMap]() contributors'
}).addTo(map);

// Create a Marker Cluster Group
var markers = L.markerClusterGroup();

// 2. Fetch the remote data
// Replace 'your_remote_data_source.geojson' with your actual API endpoint or GeoJSON file URL
//fetch('Crashes_10_Years.geojson')
fetch('all_crashes.geojson')
    .then(response => response.json())
    .then(data => {
        // 3. Process and add markers using L.geoJSON
        L.geoJSON(data, {
            onEachFeature: function (feature, layer) {
                layer.bindPopup(
                    getlabel(feature)
                )
            },
            pointToLayer(feature, latlng) {
                return getMarker(feature, latlng)
            }
        }).addTo(markers);
   }).catch(error => {
        console.error('Error fetching data:', error);
   });
map.addLayer(markers);
</script>
-->
</body>
</html>
